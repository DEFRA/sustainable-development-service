{% extends "information-page.njk" %}
{% from "summary-list/macro.njk" import govukSummaryList %}
{% from "table/macro.njk" import govukTable %}
{% import "common-text.njk" as descriptions %}
{% import "applications-text.njk" as text %}

{% set widthClass = 'govuk-grid-column-two-thirds' %}
{% set title = 'Licence application' %}

{% set rows = [
        { key: { text: "Status" }, value: { html: text.govukTaskList(data.application, data.statuses) } },
        { key: { text: "Type" }, value: { text: descriptions.APPLICATION_TYPES[data.application.applicationType].description } },
        { key: { text: "Reference" }, value: { text: data.application.applicationReferenceNumber } },
        { key: { text: "Licence holder" }, value: { text: data.applicant.fullName } }
    ]
%}

{% if data.application.submitted %}
    {{ rows.push( { key: { text: "Submitted" }, value: { text: data.application.submitted } }) }}
{% endif %}

{% if data.statuses[data.application.statusCode] === 'GRANTED' %}
    {% set tableRows = [] %}
    {% for licence in data.licences %}
        {{ tableRows.push([  { text: licence.licenceNumber },  { text: licence.startDate }, { text: licence.endDate } ]) }}
    {% endfor %}
{% endif %}

{% block pageContent %}
    {{ govukSummaryList({ classes: 'govuk-!-margin-bottom-9', rows: rows }) }}
    {% if data.statuses[data.application.statusCode] === 'GRANTED' %}
        {{ govukTable({
          caption: "Granted Licences",
          captionClasses: "govuk-table__caption--m",
          firstCellIsHeader: true,
          head: [
            { text: "Licence number" },
            { text: "Valid from" },
            { text: "Expires" }
          ],
          rows: tableRows
        }) }}
    {% endif %}
{% endblock %}

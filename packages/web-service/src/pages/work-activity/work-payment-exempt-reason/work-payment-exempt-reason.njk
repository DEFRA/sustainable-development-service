{% extends 'standard-form.njk' %}

{% from 'govuk/components/radios/macro.njk' import govukRadios %}
{% from 'govuk/components/textarea/macro.njk' import govukTextarea %}

{% set errorMap = {
        'work-payment-exempt-reason': {
          'any.required': { ref: '#work-payment-exempt-reason', text: 'You have not selected an option' }
        },
        'exempt-details': {
          'string.empty': { ref: '#exempt-details', text: 'You have not provided more detail on why your development is exempt' }
        }
    }
%}

{% set title = 'What reason do you think your development is exempt from licence payments?' %}

{% set detailsHTML %}
  {{ govukTextarea({
    name: 'exempt-details',
    id: 'exempt-details',
    value: data.paymentExemptReason if data.paymentExemptReason else '',
    errorMessage: { text: 'Provide more detail on why your development is exempt' } if error['exempt-details'],
    hint: {
      text: 'Provide more detail on the reason you think your development is exempt from license payments.'
    }
  }) }}
{% endset -%}

{% block pageContent %}

  {{ govukRadios({
    id: 'work-payment-exempt-reason',
    name: 'work-payment-exempt-reason',
    hint: {
      text: 'Select one option.'
    },
    errorMessage: { text: 'You have not selected an option' } if error['work-payment-exempt-reason'],
    items: [
      {
        checked: data.radioChecked === data.REGISTERED_PLACES_OF_WORSHIP,
        value: data.REGISTERED_PLACES_OF_WORSHIP,
        text: 'Registered places of worship'
      },
      {
        checked: data.radioChecked === data.SCHEDULED_MONUMENTS,
        value: data.SCHEDULED_MONUMENTS,
        text: 'Scheduled monuments'
      },
      {
        checked: data.radioChecked === data.LISTED_BUILDINGS,
        value: data.LISTED_BUILDINGS,
        text: 'Listed buildings'
      },
      {
        checked: data.radioChecked === data.TRADITIONAL_FARM_BUILDINGS_IN_A_COUNTRYSIDE_STEWARDSHIP_AGREEMENT,
        value: data.TRADITIONAL_FARM_BUILDINGS_IN_A_COUNTRYSIDE_STEWARDSHIP_AGREEMENT,
        text: 'Traditional farm buildings in a countryside stewardship agreement'
      },
      {
        checked: data.radioChecked === data.HOUSEHOLDER_HOME_IMPROVEMENTS,
        value: data.HOUSEHOLDER_HOME_IMPROVEMENTS,
        text: 'Homes being improved through householder planning permission or permitted development'
      },
      {
        divider: 'or'
      },
      {
        checked: data.radioChecked === data.OTHER or payload['exempt-details'] === '',
        value: data.OTHER,
        text: 'Other',
        conditional: {
          html: detailsHTML
        }
      }
    ]
  }) }}

{% endblock %}

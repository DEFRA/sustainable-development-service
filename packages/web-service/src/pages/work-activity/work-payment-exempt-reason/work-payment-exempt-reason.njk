{% extends 'standard-form.njk' %}

{% from 'govuk/components/radios/macro.njk' import govukRadios %}
{% from 'govuk/components/textarea/macro.njk' import govukTextarea %}

{% set errorMap = {
        'work-payment-exempt-reason': {
          'any.required': { ref: '#work-payment-exempt-reason', text: 'You have not selected an option' }
        },
        'exempt-details': {
          'string.empty': { ref: '#exempt-details', text: 'You have not provided more detail on why your development is exempt' },
          'string.max': { ref: '#exempt-details', text: 'You have entered too many characters' }
        }
    }
%}

{% set title = 'Why do you think your project is exempt from payment?' %}

{% set detailsHTML %}
  {{ govukTextarea({
    name: 'exempt-details',
    id: 'exempt-details',
    value: data.paymentExemptReasonExplanation if data.paymentExemptReasonExplanation else '',
    errorMessage: { text: 'Provide more detail on why your development is exempt' } if error['exempt-details'],
    hint: {
      text: 'Provide more detail on the reason you think your development is exempt from license payments.'
    }
  }) }}
{% endset -%}

{% block pageContent %}

  {{ govukRadios({
    id: 'work-payment-exempt-reason',
    name: 'work-payment-exempt-reason',
    hint: {
      text: 'Select one option.'
    },
    errorMessage: { text: 'You have not selected an option' } if error['work-payment-exempt-reason'],
    items: [
      {
        checked: data.radioChecked === data.PRESERVING_PUBLIC_HEALTH_AND_SAFETY,
        value: data.PRESERVING_PUBLIC_HEALTH_AND_SAFETY,
        text: 'Preserving public health and safety'
      },
      {
        checked: data.radioChecked === data.PREVENT_DAMAGE_TO_LIVESTOCK_CROPS_TIMBER_OR_PROPERTY,
        value: data.PREVENT_DAMAGE_TO_LIVESTOCK_CROPS_TIMBER_OR_PROPERTY,
        text: 'Preventing damage to livestock, crops, timber or property'
      },
      {
        checked: data.radioChecked === data.PREVENT_DISEASE_SPREAD,
        value: data.PREVENT_DISEASE_SPREAD,
        text: 'Preventing disease spreading'
      },
      {
        checked: data.radioChecked === data.HOUSEHOLDER_HOME_IMPROVEMENTS,
        value: data.HOUSEHOLDER_HOME_IMPROVEMENTS,
        text: 'Home improvement through householder planning permission or permitted development'
      },
      {
        checked: data.radioChecked === data.SCIENTIFIC_RESEARCH_OR_EDUCATION,
        value: data.SCIENTIFIC_RESEARCH_OR_EDUCATION,
        text: 'Scientific, research or educational purposes'
      },
      {
        checked: data.radioChecked === data.CONSERVATION_OF_PROTECTED_SPECIES,
        value: data.CONSERVATION_OF_PROTECTED_SPECIES,
        text: 'Conservation of protected species, including protection of bat roosts'
      },
      {
        checked: data.radioChecked === data.CONSERVATION_OF_A_MONUMENT_OR_BUILDING,
        value: data.CONSERVATION_OF_A_MONUMENT_OR_BUILDING,
        text: 'Conserve scheduled monuments, listed buildings, places of worship, or traditional farm buildings'
      },
      {
        divider: 'or'
      },
      {
        checked: data.radioChecked === data.OTHER or payload['exempt-details'] === '' or payload['exempt-details'].length > 4000,
        value: data.OTHER,
        text: 'Other',
        conditional: {
          html: detailsHTML
        }
      }
    ]
  }) }}

{% endblock %}

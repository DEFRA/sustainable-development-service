{% extends "standard-form.njk" %}
{% from "select/macro.njk" import govukSelect %}

{% set errorMap = {
        'site-name': {
          'string.empty': { ref: '#site-name', text: 'Choose a site' }
        }
    }
%}

{% block pageContent %}
    {% set items = [{ value: '', text: '' }] %}
    <div hidden>
    {% for rec in data.sites %}
        {% if rec.selected %}
          {{ items.push({ value: rec.siteName, text: rec.siteName, selected: true }) }}
        {% else %}
          {{ items.push({ value: rec.siteName, text: rec.siteName }) }}
        {% endif %}
    {% endfor %}
    </div>

    {{ govukSelect({
      id: "site-name",
      name: "site-name",
      label: {
        text: "Choose the site"
      },
      errorMessage: { text: "Enter the site." } if error['id'],
      defaultValue: data.selected if data.selected,
      items: items
    }) }}

    <div id="enhanced" class="govuk-form-group">
        <div id="autocomplete-container"></div>
    </div>

{% endblock %}

{% block bodyEnd %}
    {{ super() }}
    <script src="/public/javascript/accessible-autocomplete.min.js"></script>
    <script nonce={{cspNonce}} type="module">
     (function () {
        {% if error %}
            document.querySelector('#enhanced').classList.add("govuk-form-group--error");
        {% endif %}

        accessibleAutocomplete.enhanceSelectElement({
          selectElement: document.querySelector('#site-name')
        })
     })()
    </script>
{% endblock %}
